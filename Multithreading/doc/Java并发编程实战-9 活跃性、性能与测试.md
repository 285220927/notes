

# 前言

GUI 的看了，就 Copy-On-Write 提了。

# 死锁

## 定义

一组互相竞争资源的线程因互相等待，导致”永久“阻塞的现象。

## 例子说明

每个人都拥有其他人需要的资源，同时又等待其他人已经拥有的资源，并且每个人在获得所有需要的资源之前都不会放弃已经拥有的资源。

当一个线程永远地持有一个锁，并且其他线程都尝试获得这个锁时，那么他们将永远被阻塞。

## 死锁发生的四个必要条件

1. 互斥，共享资源 X 和 Y 只能被一个线程占用；
2. 占有且等待，线程 T1 已经取得共享资源 X，在等待共享资源 Y 的时候，不释放共享资源 X；
3. 不可抢占，其他线程不能强行抢占线程 T1 占有的资源
4. 循环等待，线程 T1 等待线程 T2 占有的资源，线程 T2 等待线程 T1 占有的资源，就是循环等待。

只要破坏其中一个条件，那么死锁就会被破坏。

**解决死锁的办法就是重启应用。**

## 锁顺序死锁

如果每个线程按指定顺序获取锁，就不会出现锁顺序死锁的问题。

